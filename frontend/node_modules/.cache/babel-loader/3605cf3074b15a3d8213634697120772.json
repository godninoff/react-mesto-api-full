{"ast":null,"code":"import _toConsumableArray from\"C:/Users/godni/dev/mesto-react/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:/Users/godni/dev/mesto-react/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import Header from'./Header';import Main from'./Main';import Footer from'./Footer';import EditProfilePopup from'./EditProfilePopup';import AddPlacePopup from'./AddPlacePopup';import EditAvatarPopup from'./EditAvatarPopup';import ConfirmPopup from'./ConfirmPopup';import ImagePopup from'./ImagePopup';import{CurrentUserContext}from'../contexts/CurrentUserContext';import api from'../utils/api';import{Route,Switch,Redirect,useHistory}from'react-router-dom';import ProtectedRoute from'./ProtectedRoute';import Login from'./Login';import Register from'./Register';import InfoTooltip from'./InfoTooltip';import*as auth from'../utils/auth';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditProfilePopupOpen=_React$useState2[0],setIsEditProfilePopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isAddPlacePopupOpen=_React$useState4[0],setIsAddPlacePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditAvatarPopupOpen=_React$useState6[0],setIsEditAvatarPopupOpen=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isInfoTooltipOpen=_React$useState8[0],setIsInfoTooltipOpen=_React$useState8[1];var _React$useState9=React.useState(null),_React$useState10=_slicedToArray(_React$useState9,2),selectedCard=_React$useState10[0],setSelectedCard=_React$useState10[1];var _React$useState11=React.useState({}),_React$useState12=_slicedToArray(_React$useState11,2),currentUser=_React$useState12[0],setCurrentUser=_React$useState12[1];var _React$useState13=React.useState([]),_React$useState14=_slicedToArray(_React$useState13,2),cards=_React$useState14[0],setCards=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),isSuccess=_React$useState16[0],setIsSuccess=_React$useState16[1];var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),loggedIn=_React$useState18[0],setLoggedIn=_React$useState18[1];var _React$useState19=React.useState(''),_React$useState20=_slicedToArray(_React$useState19,2),email=_React$useState20[0],setEmail=_React$useState20[1];var history=useHistory();React.useEffect(function(){Promise.all([api.getUserInfo(),api.getInitialCards()]).then(function(_ref){var _ref2=_slicedToArray(_ref,2),userData=_ref2[0],cards=_ref2[1];setCurrentUser(userData);setCards(cards);}).catch(function(e){return console.log(e);});},[]);React.useEffect(function(){if(localStorage.getItem(\"jwt\")){var jwt=localStorage.getItem(\"jwt\");auth.checkToken(jwt).then(function(res){if(res){setEmail(res.data.email);}setLoggedIn(true);history.push(\"/\");}).catch(function(e){console.error(e);setIsInfoTooltipOpen(true);});}},[]);function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});api.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(e){return console.log(e);});}function handleCardRemove(card){api.removeCard(card._id).then(function(){setCards(function(state){return state.filter(function(c){return c._id!==card._id;});});}).catch(function(e){return console.log(e);});}function handleUpdateUser(_ref3){var name=_ref3.name,about=_ref3.about;api.setUserInfo(name,about).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(e){return console.log(e);});}function handleUpdateAvatar(avatarData){api.setUserAvatar(avatarData).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(e){return console.log(e);});}function handleAddPlaceSubmit(name,link){api.createCard(name,link).then(function(res){setCards([res].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(e){return console.log(e);});}function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}function handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function handleCardClick(card){setSelectedCard(card);}function closeAllPopups(){setIsEditAvatarPopupOpen(false);setIsEditProfilePopupOpen(false);setIsInfoTooltipOpen(false);setIsAddPlacePopupOpen(false);setSelectedCard(null);}function handleRegisterSubmit(email,password){auth.register(email,password).then(function(data){if(data){localStorage.setItem(\"jwt\",data.jwt);setEmail(data.data.email);}history.push(\"/sign-in\");setIsSuccess(true);setIsInfoTooltipOpen(true);}).catch(function(e){console.error(e);setIsSuccess(false);setIsInfoTooltipOpen(true);});}function handleLoginSubmit(email,password){return auth.authorization(email,password).then(function(data){localStorage.setItem(\"jwt\",data.token);setEmail(email);setLoggedIn(true);history.push(\"/\");}).catch(function(e){console.error(e);setIsInfoTooltipOpen(true);});}function handleLogout(){localStorage.removeItem(\"jwt\");setEmail('');setLoggedIn(false);history.push(\"/sign-in\");}return/*#__PURE__*/_jsx(\"div\",{className:\"root\",children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{email:email,loggedIn:loggedIn,onSignOut:handleLogout}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",component:Main,onCardDelete:handleCardRemove,onCardLike:handleCardLike,onCardClick:handleCardClick,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,cards:cards,loggedIn:loggedIn}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Register,{handleRegister:handleRegisterSubmit})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Login,{handleLogin:handleLoginSubmit})}),/*#__PURE__*/_jsx(Route,{children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/sign-in\"})})]}),/*#__PURE__*/_jsx(EditProfilePopup,{onUpdateUser:handleUpdateUser,isOpen:isEditProfilePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(AddPlacePopup,{onAddPlace:handleAddPlaceSubmit,isOpen:isAddPlacePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(ConfirmPopup,{}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard!==null&&selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipOpen,onClose:closeAllPopups,success:isSuccess}),/*#__PURE__*/_jsx(Footer,{})]})});}export default App;","map":{"version":3,"sources":["C:/Users/godni/dev/mesto-react/src/components/App.js"],"names":["React","Header","Main","Footer","EditProfilePopup","AddPlacePopup","EditAvatarPopup","ConfirmPopup","ImagePopup","CurrentUserContext","api","Route","Switch","Redirect","useHistory","ProtectedRoute","Login","Register","InfoTooltip","auth","App","useState","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isInfoTooltipOpen","setIsInfoTooltipOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","isSuccess","setIsSuccess","loggedIn","setLoggedIn","email","setEmail","history","useEffect","Promise","all","getUserInfo","getInitialCards","then","userData","catch","e","console","log","localStorage","getItem","jwt","checkToken","res","data","push","error","handleCardLike","card","isLiked","likes","some","i","_id","changeLikeCardStatus","newCard","state","map","c","handleCardRemove","removeCard","filter","handleUpdateUser","name","about","setUserInfo","closeAllPopups","handleUpdateAvatar","avatarData","setUserAvatar","handleAddPlaceSubmit","link","createCard","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","handleRegisterSubmit","password","register","setItem","handleLoginSubmit","authorization","token","handleLogout","removeItem"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport Header from './Header';\r\nimport Main from './Main';\r\nimport Footer from './Footer';\r\nimport EditProfilePopup from './EditProfilePopup';\r\nimport AddPlacePopup from './AddPlacePopup';\r\nimport EditAvatarPopup from './EditAvatarPopup';\r\nimport ConfirmPopup from './ConfirmPopup';\r\nimport ImagePopup from './ImagePopup';\r\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\r\nimport api from '../utils/api';\r\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom'; \r\nimport ProtectedRoute from './ProtectedRoute';\r\nimport Login from './Login';\r\nimport Register from './Register';\r\nimport InfoTooltip from './InfoTooltip';\r\nimport * as auth from '../utils/auth';\r\n\r\nfunction App() {\r\n    const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\r\n    const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\r\n    const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\r\n    const [isInfoTooltipOpen, setIsInfoTooltipOpen] = React.useState(false);\r\n    const [selectedCard, setSelectedCard] = React.useState(null);\r\n    const [currentUser, setCurrentUser] = React.useState({});\r\n    const [cards, setCards] = React.useState([]);\r\n    const [isSuccess, setIsSuccess] = React.useState(false);\r\n    const [loggedIn, setLoggedIn] = React.useState(false);\r\n    const [email, setEmail] = React.useState('');\r\n    const history = useHistory();\r\n\r\n    React.useEffect(() => {\r\n        Promise.all([\r\n            api.getUserInfo(), \r\n            api.getInitialCards()\r\n        ])\r\n            .then(([userData, cards]) => {\r\n                setCurrentUser(userData);\r\n                setCards(cards);\r\n            }).catch((e) => console.log(e));\r\n    },[]);\r\n\r\n    React.useEffect(() => {\r\n        if(localStorage.getItem(\"jwt\")) {\r\n        const jwt = localStorage.getItem(\"jwt\");\r\n        auth.checkToken(jwt).then((res) => {\r\n            if(res) {\r\n                setEmail(res.data.email);\r\n            }\r\n            setLoggedIn(true);\r\n            history.push(\"/\");\r\n        }).catch((e) => {\r\n            console.error(e);\r\n            setIsInfoTooltipOpen(true);       \r\n        })\r\n    }\r\n    }, []);\r\n\r\n    function handleCardLike(card) {\r\n        const isLiked = card.likes.some(i => i._id === currentUser._id);\r\n        api.changeLikeCardStatus(card._id, !isLiked)\r\n        .then((newCard) => {\r\n            setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\r\n        }).catch((e) => console.log(e));\r\n    }\r\n\r\n    function handleCardRemove(card) {\r\n        api.removeCard(card._id)\r\n        .then(() => {\r\n            setCards((state) => state.filter((c) => c._id !== card._id));\r\n        }).catch((e) => console.log(e));\r\n    }\r\n\r\n    function handleUpdateUser({name, about}) {\r\n        api.setUserInfo(name, about)\r\n        .then((res) => {\r\n            setCurrentUser(res);\r\n            closeAllPopups();\r\n        }).catch((e) => console.log(e));   \r\n    }\r\n\r\n    function handleUpdateAvatar(avatarData) {\r\n        api.setUserAvatar(avatarData)\r\n        .then((res) => {\r\n            setCurrentUser(res);\r\n            closeAllPopups(); \r\n        }).catch((e) => console.log(e));\r\n    }\r\n\r\n    function handleAddPlaceSubmit(name, link) {\r\n        api.createCard(name, link)\r\n        .then((res) => {\r\n            setCards([res, ...cards]);\r\n            closeAllPopups();  \r\n        }).catch((e) => console.log(e));\r\n    }\r\n\r\n    function handleEditAvatarClick() {\r\n        setIsEditAvatarPopupOpen(true);\r\n    }\r\n\r\n    function handleEditProfileClick() {\r\n        setIsEditProfilePopupOpen(true);\r\n    }\r\n\r\n    function handleAddPlaceClick() {\r\n        setIsAddPlacePopupOpen(true);\r\n    }\r\n\r\n    function handleCardClick(card) {\r\n        setSelectedCard(card);\r\n    }\r\n\r\n    function closeAllPopups() {\r\n        setIsEditAvatarPopupOpen(false);\r\n        setIsEditProfilePopupOpen(false);\r\n        setIsInfoTooltipOpen(false);\r\n        setIsAddPlacePopupOpen(false);\r\n        setSelectedCard(null);\r\n    }\r\n\r\n    function handleRegisterSubmit(email, password) {\r\n        auth.register(email, password)\r\n            .then((data) => {\r\n                if(data) {\r\n                    localStorage.setItem(\"jwt\", data.jwt);\r\n                    setEmail(data.data.email);\r\n                }\r\n                history.push(\"/sign-in\");\r\n                setIsSuccess(true);\r\n                setIsInfoTooltipOpen(true);    \r\n            })\r\n            .catch((e) => {\r\n                console.error(e);\r\n                setIsSuccess(false);\r\n                setIsInfoTooltipOpen(true);    \r\n            })\r\n    }\r\n\r\n    function handleLoginSubmit(email, password) {\r\n        return auth\r\n            .authorization(email, password)\r\n            .then((data) => {\r\n                localStorage.setItem(\"jwt\", data.token);\r\n                setEmail(email);\r\n                setLoggedIn(true);\r\n                history.push(\"/\");\r\n            }).catch((e) => {\r\n                console.error(e);\r\n                setIsInfoTooltipOpen(true); \r\n            })\r\n    }\r\n\r\n    function handleLogout() {\r\n        localStorage.removeItem(\"jwt\");\r\n        setEmail('');\r\n        setLoggedIn(false);\r\n        history.push(\"/sign-in\");\r\n    }\r\n\r\n  return (\r\n    \r\n    <div className=\"root\">\r\n        <CurrentUserContext.Provider value={currentUser}>\r\n            <Header email={email} loggedIn={loggedIn} onSignOut={handleLogout} />  \r\n            <Switch>\r\n                <ProtectedRoute \r\n                    exact\r\n                    path=\"/\"\r\n                    component={Main}\r\n                    onCardDelete={handleCardRemove} \r\n                    onCardLike={handleCardLike} \r\n                    onCardClick={handleCardClick} \r\n                    onEditAvatar={handleEditAvatarClick} \r\n                    onEditProfile={handleEditProfileClick} \r\n                    onAddPlace={handleAddPlaceClick} \r\n                    cards={cards}\r\n                    loggedIn={loggedIn} \r\n                />\r\n                <Route path=\"/sign-up\">\r\n                    <Register handleRegister={handleRegisterSubmit} />\r\n                </Route>\r\n                <Route path=\"/sign-in\">\r\n                    <Login handleLogin={handleLoginSubmit} />\r\n                </Route>\r\n                <Route>\r\n                    {loggedIn ? <Redirect to=\"/\" /> : <Redirect to=\"/sign-in\" />}\r\n                </Route>\r\n            </Switch> \r\n            <EditProfilePopup \r\n                onUpdateUser={handleUpdateUser}  \r\n                isOpen={isEditProfilePopupOpen} \r\n                onClose={closeAllPopups} \r\n            />\r\n            <AddPlacePopup \r\n                onAddPlace={handleAddPlaceSubmit} \r\n                isOpen={isAddPlacePopupOpen} \r\n                onClose={closeAllPopups} \r\n            />\r\n            <EditAvatarPopup \r\n                isOpen={isEditAvatarPopupOpen} \r\n                onClose={closeAllPopups} \r\n                onUpdateAvatar={handleUpdateAvatar} \r\n            />\r\n            <ConfirmPopup />\r\n            <ImagePopup \r\n                card={selectedCard !== null && selectedCard} \r\n                onClose={closeAllPopups} \r\n            />\r\n            <InfoTooltip \r\n                isOpen={isInfoTooltipOpen}\r\n                onClose={closeAllPopups}\r\n                success={isSuccess}\r\n            />\r\n\r\n            <Footer /> \r\n        </CurrentUserContext.Provider>\r\n    </div>\r\n    \r\n  );\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}